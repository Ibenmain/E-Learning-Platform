from __future__ import annotations

from allauth.account import app_settings
from django.dispatch import Signal

from .models import UserSession


# Provides the arguments "request", "from_session", "to_session"
session_client_changed = Signal()


def on_user_logged_in(sender, **kwargs):
    request = kwargs['request']
    UserSession.objects.create_from_request(request)


def on_password_changed(sender, **kwargs):
    if not app_settings.LOGOUT_ON_PASSWORD_CHANGE:
        request = kwargs['request']
        UserSession.objects.create_from_request(request)
